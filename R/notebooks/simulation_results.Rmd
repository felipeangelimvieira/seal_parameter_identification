---
title: "EDA - Template"
author: "Exploratory Data Analysis"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
    #includes:
    #    in_header: inputs_esteticos_para_relatorio/preamble.tex
  html_document:
     theme: spacelab
     toc: true
     toc_depth: 2
     toc_float: true
     smooth_scroll: false
     number_sections: true
     highlight: tango
     code_folding: hide
classoption: "aspectratio=169"
editor_options:
  chunk_output_type: console
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T,
                      message=FALSE,
                      warning = F,
                      results = 'asis',
                      fig.align='center',  out.height= '100%', 
                      fig.pos='H',
                      out.width="100%",
                      fig.margin=F)
options("kableExtra.html.bsTable" = T)
options(tinytex.verbose = TRUE)
options(knitr.kable.NA = "-")
rm(list = setdiff(objects(),c("main.directory","usuario", "params") ))

.libPaths("~/R/lib")

```

```{r}

library(ggplot2)
library(data.table)
library(pracma)
library(dplyr)
library(stats)
library(ggthemes)
library(grid)
library(gridExtra)
library(cowplot)
library(jsonlite)


theme_set(theme_pander())
```

```{r}
.blue   = "#1D7C96"
.mauve  = "#d46edb"
.orange = "#f27b1f"
.bistre = "#876f5c"
.gray   = "#6b8599"

```


```{r}

# Dados
# ......................
dt <- fread("~/simulation/data/sin/excitation_sinusoidal.csv")


# Resultados
# .......................
coef.files <- c("~/simulation/data/sin/linreg.csv",
                "~/simulation/data/sin/gradient.csv",
                "~/simulation/data/sin/eiv.csv")

coef.dt <- data.table()
for (f in coef.files) {
  coef.dt <- rbind(coef.dt,
                   fread(f))
}
model.colors <- data.table(color=c(.blue, .mauve, .orange),
                           model=c("linreg", "gradient", "eiv"))
coef.dt <- coef.dt %>% merge(., model.colors, by="model")


# 
# .........................
```

```{r}

config.json$K[[1]][1]
```


```{r}


sel.freq <- 4


plot.data.freq <- function(sel.freq) {
  
  sel.dt <- dt[(episode == 0) &
             (freq == sel.freq) &
             (seal == T) &
             (t > 1/sel.freq*10) &
             (t < 1/sel.freq*14)]

  g1 <- ggplot(sel.dt[axis=="x"]) +
          geom_line(aes(x=t, y=x, color=.blue)) +
          geom_line(aes(x=t, y=y, color=.orange)) +
          scale_color_identity("",
                               labels = c("x", "y"), breaks=c(.blue, .orange),
                               guide = "legend") +
          scale_y_continuous(name="Posição (m)") + 
          theme_pander()
  
  g2 <- ggplot(sel.dt[axis=="x"]) +
          geom_line(aes(x=t, y=fx, color=.blue)) +
          geom_line(aes(x=t, y=fy, color=.orange)) +
          scale_color_identity("",
                               labels = c("Fx", "Fy"), breaks=c(.blue, .orange),
                               guide = "legend") +
          scale_y_continuous(name="Força (N)") + 
          theme_pander()
  
  g <- plot_grid(g1, g2, ncol=1, align="v")

  return(g)
}


```

```{r}
g.data.4hz <- plot.data.freq(4)
g.data.69hz <- plot.data.freq(69)

```

```{r Save images}

save.at <- "~/R/images/"

save.path <- function(x) paste0(save.at, x)
ggsave(save.path("data_simulation_4hz.png"), g.data.4hz)
ggsave(save.path("data_simulation_69hz.png"), g.data.69hz)

```


```{r}

sel.coef <- "cxy"
ggplot(coef.dt) +
  geom_hline(yintercept = 0, linetype="dashed", color=.gray, alpha=0.65) +
  geom_point(aes(x=freq, y=get(sel.coef), color=color)) +
  geom_line(aes(x=freq, y=get(sel.coef), color=color), alpha=0.5) +
  scale_color_identity(labels=model.colors$model, breaks=model.colors$color,
                       guide="legend") 
```

